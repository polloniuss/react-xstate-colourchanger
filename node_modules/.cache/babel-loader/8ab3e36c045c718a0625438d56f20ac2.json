{"ast":null,"code":"import { send, assign } from \"xstate\";\nimport { inspect } from '@xstate/inspect';\ninspect({\n  url: \"https://statecharts.io/inspect\",\n  iframe: false\n});\nimport { loadGrammar } from './runparser';\nimport { parse } from './chartparser';\nimport { grammar } from './grammars/homeGrammar.ts';\nexport const homeGrammar = input => {\n  const gram = loadGrammar(grammar);\n  const prs = parse(input.split(/\\s+/), gram);\n  const result = prs.resultsForRule(gram.$root)[0];\n  const answer = \"I \" + result.request.action + \" the \" + result.request.object;\n  return answer;\n};\n/*\r\nconst input = \"turn off the light\"\r\nconst prs = parse(input.split(/\\s+/), gram)\r\nconst result = prs.resultsForRule(gram.$root)[0]\r\nconsole.log(result)\r\n*/\n\nfunction say(text) {\n  return send(_context => ({\n    type: \"SPEAK\",\n    value: text\n  }));\n}\n\nfunction listen() {\n  return send('LISTEN');\n}\n\nexport const dmMachine = {\n  initial: 'init',\n  states: {\n    init: {\n      on: {\n        CLICK: 'welcome'\n      }\n    },\n    welcome: {\n      initial: \"prompt\",\n      on: {\n        ENDSPEECH: 'request'\n      },\n      states: {\n        prompt: {\n          entry: say(\"What do you want me to do ?\")\n        }\n      }\n    },\n    request: {\n      initial: \"prompt\",\n      on: {\n        RECOGNISED: {\n          actions: assign(context => {\n            return {\n              directive: homeGrammar(context.recResult)\n            };\n          }),\n          target: \"answer\"\n        }\n      },\n      states: {\n        prompt: {\n          entry: listen()\n        }\n      }\n    },\n    answer: {\n      initial: \"prompt\",\n      on: {\n        ENDSPEECH: 'init'\n      },\n      states: {\n        prompt: {\n          entry: send(context => ({\n            type: \"SPEAK\",\n            value: \"Alright. \".concat(context.directive)\n          }))\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/Bérénice/Documents/nodeJS/react-xstate-colourchanger/src/dmSmartHome.ts"],"names":["send","assign","inspect","url","iframe","loadGrammar","parse","grammar","homeGrammar","input","gram","prs","split","result","resultsForRule","$root","answer","request","action","object","say","text","_context","type","value","listen","dmMachine","initial","states","init","on","CLICK","welcome","ENDSPEECH","prompt","entry","RECOGNISED","actions","context","directive","recResult","target"],"mappings":"AAAA,SAAwBA,IAAxB,EAAsCC,MAAtC,QAAoD,QAApD;AAEA,SAASC,OAAT,QAAwB,iBAAxB;AACAA,OAAO,CAAC;AACNC,EAAAA,GAAG,EAAE,gCADC;AAENC,EAAAA,MAAM,EAAE;AAFF,CAAD,CAAP;AAKA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAASC,KAAT,QAAsB,eAAtB;AACA,SAASC,OAAT,QAAwB,2BAAxB;AAEA,OAAO,MAAMC,WAAW,GAAIC,KAAD,IAAmB;AAC1C,QAAMC,IAAI,GAAGL,WAAW,CAACE,OAAD,CAAxB;AACA,QAAMI,GAAG,GAAGL,KAAK,CAACG,KAAK,CAACG,KAAN,CAAY,KAAZ,CAAD,EAAqBF,IAArB,CAAjB;AACA,QAAMG,MAAM,GAAGF,GAAG,CAACG,cAAJ,CAAmBJ,IAAI,CAACK,KAAxB,EAA+B,CAA/B,CAAf;AACA,QAAMC,MAAM,GAAG,OAAOH,MAAM,CAACI,OAAP,CAAeC,MAAtB,GAA+B,OAA/B,GAAyCL,MAAM,CAACI,OAAP,CAAeE,MAAvE;AACA,SAAOH,MAAP;AACH,CANM;AAQP;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASI,GAAT,CAAaC,IAAb,EAAyD;AACrD,SAAOrB,IAAI,CAAEsB,QAAD,KAA2B;AAAEC,IAAAA,IAAI,EAAE,OAAR;AAAiBC,IAAAA,KAAK,EAAEH;AAAxB,GAA3B,CAAD,CAAX;AACH;;AAED,SAASI,MAAT,GAAgD;AAC5C,SAAOzB,IAAI,CAAC,QAAD,CAAX;AACH;;AAED,OAAO,MAAM0B,SAAmD,GAAI;AAChEC,EAAAA,OAAO,EAAE,MADuD;AAEhEC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAE;AACFC,MAAAA,EAAE,EAAE;AACAC,QAAAA,KAAK,EAAE;AADP;AADF,KADF;AAMXC,IAAAA,OAAO,EAAE;AACRL,MAAAA,OAAO,EAAE,QADD;AAELG,MAAAA,EAAE,EAAE;AAAEG,QAAAA,SAAS,EAAE;AAAb,OAFC;AAGLL,MAAAA,MAAM,EAAE;AACPM,QAAAA,MAAM,EAAE;AAAEC,UAAAA,KAAK,EAAEf,GAAG,CAAC,6BAAD;AAAZ;AADD;AAHH,KANE;AAaXH,IAAAA,OAAO,EAAE;AACLU,MAAAA,OAAO,EAAE,QADJ;AAELG,MAAAA,EAAE,EAAE;AACHM,QAAAA,UAAU,EAAE;AACXC,UAAAA,OAAO,EAAEpC,MAAM,CAAEqC,OAAD,IAAa;AAAE,mBAAO;AAAEC,cAAAA,SAAS,EAAE/B,WAAW,CAAC8B,OAAO,CAACE,SAAT;AAAxB,aAAP;AAAqD,WAArE,CADJ;AAEdC,UAAAA,MAAM,EAAE;AAFM;AADT,OAFC;AAQLb,MAAAA,MAAM,EAAE;AACPM,QAAAA,MAAM,EAAE;AAAEC,UAAAA,KAAK,EAAEV,MAAM;AAAf;AADD;AARH,KAbE;AAyBXT,IAAAA,MAAM,EAAE;AACPW,MAAAA,OAAO,EAAE,QADF;AAEJG,MAAAA,EAAE,EAAE;AAAEG,QAAAA,SAAS,EAAE;AAAb,OAFA;AAGJL,MAAAA,MAAM,EAAE;AACPM,QAAAA,MAAM,EAAE;AACPC,UAAAA,KAAK,EAAEnC,IAAI,CAAEsC,OAAD,KAAc;AACzBf,YAAAA,IAAI,EAAE,OADmB;AAEzBC,YAAAA,KAAK,qBAAcc,OAAO,CAACC,SAAtB;AAFoB,WAAd,CAAD;AADJ;AADD;AAHJ;AAzBG;AAFwD,CAA7D","sourcesContent":["import { MachineConfig, send, Action, assign } from \"xstate\";\r\n\r\nimport { inspect } from '@xstate/inspect';\r\ninspect({\r\n  url: \"https://statecharts.io/inspect\",\r\n  iframe: false\r\n});\r\n\r\nimport { loadGrammar } from './runparser'\r\nimport { parse } from './chartparser'\r\nimport { grammar } from './grammars/homeGrammar.ts'\r\n\r\nexport const homeGrammar = (input: string) => {\r\n    const gram = loadGrammar(grammar);\r\n    const prs = parse(input.split(/\\s+/), gram);\r\n    const result = prs.resultsForRule(gram.$root)[0]\r\n    const answer = \"I \" + result.request.action + \" the \" + result.request.object;\r\n    return answer\r\n}\r\n\r\n/*\r\nconst input = \"turn off the light\"\r\nconst prs = parse(input.split(/\\s+/), gram)\r\nconst result = prs.resultsForRule(gram.$root)[0]\r\nconsole.log(result)\r\n*/\r\n\r\nfunction say(text: string): Action<SDSContext, SDSEvent> {\r\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\r\n}\r\n\r\nfunction listen(): Action<SDSContext, SDSEvent> {\r\n    return send('LISTEN')\r\n}\r\n\r\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\r\n    initial: 'init',\r\n    states: {\r\n        init: {\r\n            on: {\r\n                CLICK: 'welcome'\r\n            }\r\n        },\r\n\twelcome: {\r\n\t\tinitial: \"prompt\",\r\n\t    on: { ENDSPEECH: 'request' },\r\n\t    states: {\r\n\t    \tprompt: { entry: say(\"What do you want me to do ?\")},\r\n\t    }\r\n\t},\r\n\trequest: {\r\n\t    initial: \"prompt\",\r\n\t    on: { \r\n\t    \tRECOGNISED: {\r\n\t    \t\tactions: assign((context) => { return { directive: homeGrammar(context.recResult)} }),\r\n\t\t\t\ttarget: \"answer\",\r\n\t\t\t},\r\n\t    },\r\n\t    states: {\r\n\t    \tprompt: { entry: listen() },\r\n\t    },\r\n\t},\r\n\tanswer: {\r\n\t\tinitial: \"prompt\",\r\n\t    on: { ENDSPEECH: 'init' },\r\n\t    states: {\r\n\t    \tprompt: {\r\n\t    \t\tentry: send((context) => ({\r\n\t    \t\t\ttype: \"SPEAK\",\r\n\t    \t\t\tvalue: `Alright. ${context.directive}`\r\n\t    \t\t}))\r\n\t    \t}\r\n\t    },\r\n\t}\r\n    }})"]},"metadata":{},"sourceType":"module"}