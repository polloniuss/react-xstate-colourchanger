{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nimport { useState, useEffect, useRef } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport { interpret, State } from 'xstate';\nimport useConstant from './useConstant';\nimport { partition } from './utils';\nvar ReactEffectType;\n\n(function (ReactEffectType) {\n  ReactEffectType[ReactEffectType[\"Effect\"] = 1] = \"Effect\";\n  ReactEffectType[ReactEffectType[\"LayoutEffect\"] = 2] = \"LayoutEffect\";\n})(ReactEffectType || (ReactEffectType = {}));\n\nfunction createReactActionFunction(exec, tag) {\n  var effectExec = function effectExec() {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    } // don't execute; just return\n\n\n    return function () {\n      return exec.apply(void 0, __spread(args));\n    };\n  };\n\n  Object.defineProperties(effectExec, {\n    name: {\n      value: \"effect:\" + exec.name\n    },\n    __effect: {\n      value: tag\n    }\n  });\n  return effectExec;\n}\n\nexport function asEffect(exec) {\n  return createReactActionFunction(exec, ReactEffectType.Effect);\n}\nexport function asLayoutEffect(exec) {\n  return createReactActionFunction(exec, ReactEffectType.LayoutEffect);\n}\n\nfunction executeEffect(action, state) {\n  var exec = action.exec;\n  var originalExec = exec(state.context, state._event.data, {\n    action: action,\n    state: state,\n    _event: state._event\n  });\n  originalExec();\n}\n\nexport function useMachine(getMachine, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var machine = useConstant(function () {\n    return typeof getMachine === 'function' ? getMachine() : getMachine;\n  });\n\n  if (process.env.NODE_ENV !== 'production' && typeof getMachine !== 'function') {\n    var _a = __read(useState(machine), 1),\n        initialMachine = _a[0];\n\n    if (machine !== initialMachine) {\n      console.warn('Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\\n' + 'Please make sure that you pass the same Machine as argument each time.');\n    }\n  }\n\n  var context = options.context,\n      guards = options.guards,\n      actions = options.actions,\n      activities = options.activities,\n      services = options.services,\n      delays = options.delays,\n      rehydratedState = options.state,\n      interpreterOptions = __rest(options, [\"context\", \"guards\", \"actions\", \"activities\", \"services\", \"delays\", \"state\"]);\n\n  var _b = __read(useConstant(function () {\n    var machineConfig = {\n      context: context,\n      guards: guards,\n      actions: actions,\n      activities: activities,\n      services: services,\n      delays: delays\n    };\n    var resolvedMachine = machine.withConfig(machineConfig, __assign(__assign({}, machine.context), context));\n    return [resolvedMachine, interpret(resolvedMachine, __assign({\n      deferEvents: true\n    }, interpreterOptions))];\n  }), 2),\n      resolvedMachine = _b[0],\n      service = _b[1];\n\n  var _c = __read(useState(function () {\n    // Always read the initial state to properly initialize the machine\n    // https://github.com/davidkpiano/xstate/issues/1334\n    var initialState = resolvedMachine.initialState;\n    return rehydratedState ? State.create(rehydratedState) : initialState;\n  }), 2),\n      state = _c[0],\n      setState = _c[1];\n\n  var effectActionsRef = useRef([]);\n  var layoutEffectActionsRef = useRef([]);\n  useIsomorphicLayoutEffect(function () {\n    service.onTransition(function (currentState) {\n      var _a, _b; // Only change the current state if:\n      // - the incoming state is the \"live\" initial state (since it might have new actors)\n      // - OR the incoming state actually changed.\n      //\n      // The \"live\" initial state will have .changed === undefined.\n\n\n      var initialStateChanged = currentState.changed === undefined && Object.keys(currentState.children).length;\n\n      if (currentState.changed || initialStateChanged) {\n        setState(currentState);\n      }\n\n      if (currentState.actions.length) {\n        var reactEffectActions = currentState.actions.filter(function (action) {\n          return typeof action.exec === 'function' && '__effect' in action.exec;\n        });\n\n        var _c = __read(partition(reactEffectActions, function (action) {\n          return action.exec.__effect === ReactEffectType.Effect;\n        }), 2),\n            effectActions = _c[0],\n            layoutEffectActions = _c[1];\n\n        (_a = effectActionsRef.current).push.apply(_a, __spread(effectActions.map(function (effectAction) {\n          return [effectAction, currentState];\n        })));\n\n        (_b = layoutEffectActionsRef.current).push.apply(_b, __spread(layoutEffectActions.map(function (layoutEffectAction) {\n          return [layoutEffectAction, currentState];\n        })));\n      }\n    }).start(rehydratedState ? State.create(rehydratedState) : undefined);\n    return function () {\n      service.stop();\n    };\n  }, []); // Make sure actions and services are kept updated when they change.\n  // This mutation assignment is safe because the service instance is only used\n  // in one place -- this hook's caller.\n\n  useEffect(function () {\n    Object.assign(service.machine.options.actions, actions);\n  }, [actions]);\n  useEffect(function () {\n    Object.assign(service.machine.options.services, services);\n  }, [services]); // this is somewhat weird - this should always be flushed within useLayoutEffect\n  // but we don't want to receive warnings about useLayoutEffect being used on the server\n  // so we have to use `useIsomorphicLayoutEffect` to silence those warnings\n\n  useIsomorphicLayoutEffect(function () {\n    while (layoutEffectActionsRef.current.length) {\n      var _a = __read(layoutEffectActionsRef.current.shift(), 2),\n          layoutEffectAction = _a[0],\n          effectState = _a[1];\n\n      executeEffect(layoutEffectAction, effectState);\n    }\n  }, [state]); // https://github.com/davidkpiano/xstate/pull/1202#discussion_r429677773\n\n  useEffect(function () {\n    while (effectActionsRef.current.length) {\n      var _a = __read(effectActionsRef.current.shift(), 2),\n          effectAction = _a[0],\n          effectState = _a[1];\n\n      executeEffect(effectAction, effectState);\n    }\n  }, [state]);\n  return [state, service.send, service];\n}","map":{"version":3,"sources":["C:/Users/Bérénice/Documents/nodeJS/own_project/react-xstate-colourchanger/node_modules/@xstate/react/es/useMachine.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__read","o","m","Symbol","iterator","r","ar","next","done","push","value","error","__spread","concat","useState","useEffect","useRef","useIsomorphicLayoutEffect","interpret","State","useConstant","partition","ReactEffectType","createReactActionFunction","exec","tag","effectExec","args","_i","defineProperties","name","__effect","asEffect","Effect","asLayoutEffect","LayoutEffect","executeEffect","action","state","originalExec","context","_event","data","useMachine","getMachine","options","machine","process","env","NODE_ENV","_a","initialMachine","console","warn","guards","actions","activities","services","delays","rehydratedState","interpreterOptions","_b","machineConfig","resolvedMachine","withConfig","deferEvents","service","_c","initialState","create","setState","effectActionsRef","layoutEffectActionsRef","onTransition","currentState","initialStateChanged","changed","undefined","keys","children","reactEffectActions","filter","effectActions","layoutEffectActions","current","map","effectAction","layoutEffectAction","start","stop","shift","effectState","send"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\nvar __read = (this && this.__read) || function (o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n};\r\nvar __spread = (this && this.__spread) || function () {\r\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n};\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\r\nimport { interpret, State } from 'xstate';\r\nimport useConstant from './useConstant';\r\nimport { partition } from './utils';\r\nvar ReactEffectType;\r\n(function (ReactEffectType) {\r\n    ReactEffectType[ReactEffectType[\"Effect\"] = 1] = \"Effect\";\r\n    ReactEffectType[ReactEffectType[\"LayoutEffect\"] = 2] = \"LayoutEffect\";\r\n})(ReactEffectType || (ReactEffectType = {}));\r\nfunction createReactActionFunction(exec, tag) {\r\n    var effectExec = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        // don't execute; just return\r\n        return function () {\r\n            return exec.apply(void 0, __spread(args));\r\n        };\r\n    };\r\n    Object.defineProperties(effectExec, {\r\n        name: { value: \"effect:\" + exec.name },\r\n        __effect: { value: tag }\r\n    });\r\n    return effectExec;\r\n}\r\nexport function asEffect(exec) {\r\n    return createReactActionFunction(exec, ReactEffectType.Effect);\r\n}\r\nexport function asLayoutEffect(exec) {\r\n    return createReactActionFunction(exec, ReactEffectType.LayoutEffect);\r\n}\r\nfunction executeEffect(action, state) {\r\n    var exec = action.exec;\r\n    var originalExec = exec(state.context, state._event.data, {\r\n        action: action,\r\n        state: state,\r\n        _event: state._event\r\n    });\r\n    originalExec();\r\n}\r\nexport function useMachine(getMachine, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var machine = useConstant(function () {\r\n        return typeof getMachine === 'function' ? getMachine() : getMachine;\r\n    });\r\n    if (process.env.NODE_ENV !== 'production' &&\r\n        typeof getMachine !== 'function') {\r\n        var _a = __read(useState(machine), 1), initialMachine = _a[0];\r\n        if (machine !== initialMachine) {\r\n            console.warn('Machine given to `useMachine` has changed between renders. This is not supported and might lead to unexpected results.\\n' +\r\n                'Please make sure that you pass the same Machine as argument each time.');\r\n        }\r\n    }\r\n    var context = options.context, guards = options.guards, actions = options.actions, activities = options.activities, services = options.services, delays = options.delays, rehydratedState = options.state, interpreterOptions = __rest(options, [\"context\", \"guards\", \"actions\", \"activities\", \"services\", \"delays\", \"state\"]);\r\n    var _b = __read(useConstant(function () {\r\n        var machineConfig = {\r\n            context: context,\r\n            guards: guards,\r\n            actions: actions,\r\n            activities: activities,\r\n            services: services,\r\n            delays: delays\r\n        };\r\n        var resolvedMachine = machine.withConfig(machineConfig, __assign(__assign({}, machine.context), context));\r\n        return [\r\n            resolvedMachine,\r\n            interpret(resolvedMachine, __assign({ deferEvents: true }, interpreterOptions))\r\n        ];\r\n    }), 2), resolvedMachine = _b[0], service = _b[1];\r\n    var _c = __read(useState(function () {\r\n        // Always read the initial state to properly initialize the machine\r\n        // https://github.com/davidkpiano/xstate/issues/1334\r\n        var initialState = resolvedMachine.initialState;\r\n        return rehydratedState ? State.create(rehydratedState) : initialState;\r\n    }), 2), state = _c[0], setState = _c[1];\r\n    var effectActionsRef = useRef([]);\r\n    var layoutEffectActionsRef = useRef([]);\r\n    useIsomorphicLayoutEffect(function () {\r\n        service\r\n            .onTransition(function (currentState) {\r\n            var _a, _b;\r\n            // Only change the current state if:\r\n            // - the incoming state is the \"live\" initial state (since it might have new actors)\r\n            // - OR the incoming state actually changed.\r\n            //\r\n            // The \"live\" initial state will have .changed === undefined.\r\n            var initialStateChanged = currentState.changed === undefined &&\r\n                Object.keys(currentState.children).length;\r\n            if (currentState.changed || initialStateChanged) {\r\n                setState(currentState);\r\n            }\r\n            if (currentState.actions.length) {\r\n                var reactEffectActions = currentState.actions.filter(function (action) {\r\n                    return (typeof action.exec === 'function' &&\r\n                        '__effect' in\r\n                            action.exec);\r\n                });\r\n                var _c = __read(partition(reactEffectActions, function (action) {\r\n                    return action.exec.__effect === ReactEffectType.Effect;\r\n                }), 2), effectActions = _c[0], layoutEffectActions = _c[1];\r\n                (_a = effectActionsRef.current).push.apply(_a, __spread(effectActions.map(function (effectAction) { return [effectAction, currentState]; })));\r\n                (_b = layoutEffectActionsRef.current).push.apply(_b, __spread(layoutEffectActions.map(function (layoutEffectAction) { return [layoutEffectAction, currentState]; })));\r\n            }\r\n        })\r\n            .start(rehydratedState ? State.create(rehydratedState) : undefined);\r\n        return function () {\r\n            service.stop();\r\n        };\r\n    }, []);\r\n    // Make sure actions and services are kept updated when they change.\r\n    // This mutation assignment is safe because the service instance is only used\r\n    // in one place -- this hook's caller.\r\n    useEffect(function () {\r\n        Object.assign(service.machine.options.actions, actions);\r\n    }, [actions]);\r\n    useEffect(function () {\r\n        Object.assign(service.machine.options.services, services);\r\n    }, [services]);\r\n    // this is somewhat weird - this should always be flushed within useLayoutEffect\r\n    // but we don't want to receive warnings about useLayoutEffect being used on the server\r\n    // so we have to use `useIsomorphicLayoutEffect` to silence those warnings\r\n    useIsomorphicLayoutEffect(function () {\r\n        while (layoutEffectActionsRef.current.length) {\r\n            var _a = __read(layoutEffectActionsRef.current.shift(), 2), layoutEffectAction = _a[0], effectState = _a[1];\r\n            executeEffect(layoutEffectAction, effectState);\r\n        }\r\n    }, [state]); // https://github.com/davidkpiano/xstate/pull/1202#discussion_r429677773\r\n    useEffect(function () {\r\n        while (effectActionsRef.current.length) {\r\n            var _a = __read(effectActionsRef.current.shift(), 2), effectAction = _a[0], effectState = _a[1];\r\n            executeEffect(effectAction, effectState);\r\n        }\r\n    }, [state]);\r\n    return [state, service.send, service];\r\n}\r\n"]},"metadata":{},"sourceType":"module"}